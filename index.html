
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="baidu-site-verification" content="k49IAqAJW3" />
  
    <title>有药就给你</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="feng">
    

    
    <meta property="og:type" content="website">
<meta property="og:title" content="有药就给你">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="有药就给你">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="有药就给你">

    
    <link rel="alternative" href="/atom.xml" title="有药就给你" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="有药就给你" title="有药就给你"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="有药就给你">有药就给你</a></h1>
				<h2 class="blog-motto">我是一个慷慨的人，有药都会给你的</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
						<form class="search" action="http://zhannei.baidu.com/cse/search" target="_blank">
							<label>Search</label>
						<input name="s" type="hidden" value= null ><input type="text" name="q" size="30" placeholder="搜索"><br>
						</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/09/18/etcd集群实践/" title="etcd集群实践" itemprop="url">etcd集群实践</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="feng" target="_blank" itemprop="author">feng</a>
		
  <p class="article-time">
    <time datetime="2017-09-18T06:54:09.000Z" itemprop="datePublished"> 发表于 2017-09-18</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>这两天要搞kubernetes ,提及etcd，etcd具体介绍自己百度一下，我们现在实践的etcd集群的建立。<br>环境：<br>vm-h1 10.10.1.231<br>vm-h2 10.10.1.232<br>vm-h3 10.10.1.233<br>都是centos7  没有装防火墙<br>A ,三台机器使用 yum install etcd<br>修改  /usr/lib/systemd/system/etcd.service<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">[Unit]</div><div class="line">Description=Etcd Server</div><div class="line">After=network.target</div><div class="line">After=network-online.target</div><div class="line">Wants=network-online.target</div><div class="line"></div><div class="line">[Service]</div><div class="line">Type=notify</div><div class="line">WorkingDirectory=/var/lib/etcd/</div><div class="line">EnvironmentFile=-/etc/etcd/etcd.conf</div><div class="line">User=etcd</div><div class="line"># set GOMAXPROCS to number of processors</div><div class="line">ExecStart=/bin/bash -c &quot;GOMAXPROCS=$(nproc) /usr/bin/etcd --name=\&quot;$&#123;ETCD_NAME&#125;\&quot; \</div><div class="line">  --initial-advertise-peer-urls=\&quot;$&#123;ETCD_INITIAL_ADVERTISE_PEER_URLS&#125;\&quot; \</div><div class="line">  --listen-peer-urls=\&quot;$&#123;ETCD_LISTEN_PEER_URLS&#125;\&quot; \</div><div class="line">  --listen-client-urls=\&quot;$&#123;ETCD_LISTEN_CLIENT_URLS&#125;\&quot; \</div><div class="line">  --advertise-client-urls=\&quot;$&#123;ETCD_ADVERTISE_CLIENT_URLS&#125;\&quot; \</div><div class="line">  --initial-cluster-token=\&quot;$&#123;ETCD_INITIAL_CLUSTER_TOKEN&#125;\&quot; \</div><div class="line">  --initial-cluster=\&quot;$&#123;ETCD_INITIAL_CLUSTER&#125;\&quot; \</div><div class="line">  --initial-cluster-state=\&quot;$&#123;ETCD_INITIAL_CLUSTER_STATE&#125;\&quot; \</div><div class="line">  --data-dir=\&quot;$&#123;ETCD_DATA_DIR&#125;\&quot; &quot;</div><div class="line"></div><div class="line">Restart=on-failure</div><div class="line">LimitNOFILE=65536</div><div class="line"></div><div class="line">[Install]</div><div class="line">WantedBy=multi-user.target</div></pre></td></tr></table></figure></p>
<p>原始内容里没有开启集群的代码，折腾好久<br>B 修改 /etc/etcd/etcd.conf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"># [member]</div><div class="line">ETCD_NAME=&quot;vm-h1&quot;</div><div class="line">ETCD_DATA_DIR=&quot;/var/lib/etcd/default.etcd&quot;</div><div class="line">#ETCD_WAL_DIR=&quot;&quot;</div><div class="line">#ETCD_SNAPSHOT_COUNT=&quot;10000&quot;</div><div class="line">#ETCD_HEARTBEAT_INTERVAL=&quot;100&quot;</div><div class="line">#ETCD_ELECTION_TIMEOUT=&quot;1000&quot;</div><div class="line">ETCD_LISTEN_PEER_URLS=&quot;http://0.0.0.0:2380&quot;</div><div class="line">ETCD_LISTEN_CLIENT_URLS=&quot;http://0.0.0.0:2379&quot;</div><div class="line">#ETCD_MAX_SNAPSHOTS=&quot;5&quot;</div><div class="line">#ETCD_MAX_WALS=&quot;5&quot;</div><div class="line">#ETCD_CORS=&quot;&quot;</div><div class="line">#</div><div class="line">#[cluster]</div><div class="line">ETCD_INITIAL_ADVERTISE_PEER_URLS=&quot;http://10.10.1.231:2380&quot;</div><div class="line"># if you use different ETCD_NAME (e.g. test), set ETCD_INITIAL_CLUSTER value for this name, i.e. &quot;test=http://...&quot;</div><div class="line">ETCD_INITIAL_CLUSTER=&quot;vm-h1=http://vm-h1:2380,vm-h2=http://vm-h2:2380,vm-h3=http://vm-h3:2380&quot;</div><div class="line">ETCD_INITIAL_CLUSTER_STATE=&quot;new&quot;</div><div class="line">ETCD_INITIAL_CLUSTER_TOKEN=&quot;etcd-cluster-1&quot;</div><div class="line">ETCD_ADVERTISE_CLIENT_URLS=&quot;http://10.10.1.231:2379&quot;</div></pre></td></tr></table></figure></p>
<p>对应的个改里面的 ETCD_INITIAL_ADVERTISE_PEER_URLS，ETCD_ADVERTISE_CLIENT_URLS<br>用systemdctl start etcd.<br>如果要因为ETCD_DATA_DIR权限错误，可是以前运行过，可以先停止三个机器，然后把 ETCD_DATA_DIR 目录里内空全删除，再重启机器。</p>
<p>C 检查：<br>etcdctl cluster-health<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">member 28253e92e46b635b is healthy: got healthy result from http://10.10.1.232:2379</div><div class="line">member 481331b384513d9e is healthy: got healthy result from http://10.10.1.231:2379</div><div class="line">member cbeefbc57f0e8ab9 is healthy: got healthy result from http://10.10.1.233:2379</div></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/ectd/">ectd</a>►<a class="article-category-link" href="/categories/ectd/linux/">linux</a>►<a class="article-category-link" href="/categories/ectd/linux/收集/">收集</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/etcd/">etcd</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/09/13/vpn-跳板设置/" title="vpn 跳板设置" itemprop="url">vpn 跳板设置</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="feng" target="_blank" itemprop="author">feng</a>
		
  <p class="article-time">
    <time datetime="2017-09-13T07:08:26.000Z" itemprop="datePublished"> 发表于 2017-09-13</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>为了方便工作，在公司服务器上搞了各种虚拟机试验各种环境，也装了vpn(pptp)，调试也通了。<br>远程联结也能登上各种搞事情，在家就像在公司局域网里。<br>可是，上面说的情况不包括 操蛋的歌华有线，就不知道为什么联不上公司的vpn,不过可以连上阿里云服务<br>器装的vpn,阿里云上上公司的vpn也没任何毛病。所以想着通过一台机器中转上公司的vpn.<br>环境如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">公司内网网段：</div><div class="line">   10.10.1.0</div><div class="line">公司vpn:</div><div class="line">  分配地址是  10.10.10.x</div><div class="line">中转服务器：</div><div class="line">   分配地址是  10.10.12.x</div></pre></td></tr></table></figure></p>
<p>操作流程：<br>1,中转服务器 拨号 上公司vpn ，产生ppp0,获得ip 10.10.10.3<br>2,中转服务器 添加 路由<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">route add -net 10.10.0.0/16 dev ppp0</div></pre></td></tr></table></figure></p>
<p>此时，在中转服务器可以连上公司 内网的服务器 10.10.1.x<br>3,在要上公司vpn的机器（C）上 拨号 中转服务器上的vpn ,此时，中转服务器上会增加<br>一个ppp1, C机器上上会产生 ppp0, C机器上添加路由<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">route add -net 10.10.0.0/16 dev ppp0</div></pre></td></tr></table></figure></p>
<p>4,在中间服务器上执行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">firewall-cmd   --direct --passthrough ipv4 -t nat -I POSTROUTING -o ppp0 -j MASQUERADE -s 10.10.0.0/16</div><div class="line"></div><div class="line">firewall-cmd  --direct --add-rule ipv4 filter FORWARD 0 -i ppp1 -o ppp0 -j ACCEPT</div><div class="line">firewall-cmd  --direct --add-rule ipv4 filter FORWARD 0 -i ppp1 -o ppp0 -j ACCEPT</div></pre></td></tr></table></figure></p>
<p>些时C机器应该可在直接访问 10.10.1.x,<br>后面两句不执行也没啥毛病，需要注意 C机器上的MTU不能为默认，因为经过两次vpn，有问题，调小比如1450(看情况吧，有时好像也没问题)就差不多。<br>后记，操蛋的歌华有线，搞出这么多事儿</p>
<p><font style="color:#f00">后记：后面两句不执行，可以ping通，但是连不上，会提示没有路由，可以加上参数 –permanent ，就不用每次执行了, 如果有多个机器要经过这个中转机器，可以用用ppp+表示多个, 如下<br> </font><br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">firewall-cmd --permanent --direct --add-rule ipv4 filter FORWARD 0 -i ppp+ -o ppp0 -j ACCEPT</div><div class="line">firewall-cmd --permanent --direct --add-rule ipv4 filter FORWARD 0 -i ppp0 -o ppp+ -j ACCEPT</div></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/vpn/">vpn</a>►<a class="article-category-link" href="/categories/vpn/linux/">linux</a>►<a class="article-category-link" href="/categories/vpn/linux/收集/">收集</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/vpn/">vpn</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/09/01/ice起步-三-IceGrid/" title="ice起步(三)_IceGrid" itemprop="url">ice起步(三)_IceGrid</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="feng" target="_blank" itemprop="author">feng</a>
		
  <p class="article-time">
    <time datetime="2017-09-01T07:23:08.000Z" itemprop="datePublished"> 发表于 2017-09-01</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>可以理解为分布式的一个架构，一个 IceGrid域由一个注册表（Registry）和任何数目的节点(Node)构成。<br>注册表记录所有的服务地址，实现负载均衡，容灾等功能。<br>1 Registry不依赖其他任务服务，类似dubo的zookeeper注册中心，<br> 配置文件registry.cfg：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">IceGrid.Registry.Client.Endpoints=tcp -p 4061</div><div class="line">IceGrid.Registry.Server.Endpoints=tcp</div><div class="line">IceGrid.Registry.Internal.Endpoints=tcp</div><div class="line">IceGrid.Registry.AdminPermissionsVerifier=IceGrid/NullPermissionsVerifier</div><div class="line">IceGrid.Registry.LMDB.Path=/home/ice/registryDb</div><div class="line">IceGrid.Registry.DynamicRegistration=1</div></pre></td></tr></table></figure></p>
<p>在一台机器上把这个服务运行起来<br>icegridregistry –Ice.Config=/home/ice/registry.cfg  –daemon<br>当然也可以在一台机器运行，为了更好的体验分，我在另一台机器上运行这个服务，需要注意防火墙开发4061端口。<br>2，服务器端代码 IceBoxPrinter 无变化，但配置文件需要修改。<br>这里我重建了一个配置文件 registry.properties 内容如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">#IceBox.InstanceName=SimplePrinterBox</div><div class="line">IceBox.InheritProperties=1</div><div class="line">Ice.Trace.Network=1</div><div class="line">Ice.Trace.ThreadPool=1 </div><div class="line">#所有服务初始化完成之后打印 xxx ready</div><div class="line">IceBox.PrintServicesReady=SimplePrinterBox iceGrid  ready.....</div><div class="line">#SimplePrinter配置</div><div class="line">IceBox.Service.SimplePrinter=com.feng.ice.server.icebox.IceBoxPrinter 100 101 102</div><div class="line">SimplePrinter.Endpoints=tcp -p 10000  </div><div class="line">#可不指定端口号 改成 SimplePrinter.Endpoints=tcp ，随机端口</div><div class="line">#不方便本地调试。</div><div class="line">#上面无变化，下面新加，需要指定好registry的主机端口号</div><div class="line">##iceGrid</div><div class="line">Ice.Default.Locator=IceGrid/Locator:tcp -h 10.10.1.201 -p 4061</div><div class="line">SimplePrinter.AdapterId=SimplePrinterAdapter</div><div class="line"># SimplePrinter.AdapterId=SimplePrinterAdapter这个值，会在客户端用到，需要唯一</div></pre></td></tr></table></figure></p>
<p>3 启动IceBox 进行注册：main class com.zeroc.IceBox.Server  添加参数：<br>–Ice.Config=/路径/registry.properties<br>4 客户端调用代码更改<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">package com.feng.ice.client;</div><div class="line"></div><div class="line">import com.feng.ice.Demo.PrinterPrx;</div><div class="line"></div><div class="line">public class ClientGrid &#123;</div><div class="line">	public static void main(String[] args) &#123;</div><div class="line">		String[] initParams =  new String[]&#123;&quot;--Ice.Default.Locator=IceGrid/Locator:tcp -h 10.10.1.201 -p 4061&quot;&#125;;</div><div class="line">		try(com.zeroc.Ice.Communicator communicator = com.zeroc.Ice.Util.initialize(initParams))</div><div class="line">        &#123;</div><div class="line">           // com.zeroc.Ice.ObjectPrx base = communicator.stringToProxy(&quot;SimplePrinter:default -p 10000&quot;);</div><div class="line">            com.zeroc.Ice.ObjectPrx base = communicator.stringToProxy(&quot;SimplePrinter@SimplePrinterAdapter&quot;);</div><div class="line">            PrinterPrx printer =  PrinterPrx.checkedCast(base);</div><div class="line">            if(printer == null)</div><div class="line">            &#123;</div><div class="line">                throw new Error(&quot;Invalid proxy&quot;);</div><div class="line">            &#125;</div><div class="line">            for(int i=0;i&lt;10;i++)&#123;</div><div class="line">            	 printer.printString(&quot;Hello World! &quot; + i);</div><div class="line">            	 System.out.println(&quot;---------&gt;&quot; + i );</div><div class="line">            &#125;</div><div class="line">           </div><div class="line">        &#125;</div><div class="line"></div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>communicator.stringToProxy(“SimplePrinter@SimplePrinterAdapter”); 这个前面是 需要和代码和配置文件对应起来<br>5 就这样子。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/ice/">ice</a>►<a class="article-category-link" href="/categories/ice/收集/">收集</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/ice/">ice</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/09/01/ice起步(二)IceBox/" title="ice起步(二)_IceBox" itemprop="url">ice起步(二)_IceBox</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="feng" target="_blank" itemprop="author">feng</a>
		
  <p class="article-time">
    <time datetime="2017-09-01T06:52:11.000Z" itemprop="datePublished"> 发表于 2017-09-01</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>IceBox 可以代替通常的server,方便进行很多ice服务管理，<br>可以理解成一个类似tomcat的容器，  里面可以有很多服务。<br>服务器 接口方法实现接上一篇。<br>步骤，<br>1，实现com.zeroc.IceBox.Service，完成方法。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">package com.feng.ice.server.icebox;</div><div class="line"></div><div class="line">import com.feng.ice.server.impl.PrinterI;</div><div class="line">import com.zeroc.Ice.Communicator;</div><div class="line">import com.zeroc.IceBox.Service;</div><div class="line">public class IceBoxPrinter  implements  Service &#123;</div><div class="line">	private com.zeroc.Ice.ObjectAdapter _adapter;</div><div class="line">	public void start(String name,  Communicator communicator, String[] args) &#123;</div><div class="line">		// TODO Auto-generated method stub</div><div class="line">		System.out.println(  &quot;name:&quot; + name);</div><div class="line">		for(String s:args)</div><div class="line">		System.out.println(  &quot;args:&quot; + s);</div><div class="line">		_adapter = communicator.createObjectAdapter(name);</div><div class="line">		com.zeroc.Ice.Object object =   new PrinterI();</div><div class="line">		//_adapter.add(object, com.zeroc.Ice.Util.stringToIdentity(&quot;SimplePrinter&quot;));</div><div class="line">		_adapter.add(object, com.zeroc.Ice.Util.stringToIdentity(&quot;SimplePrinter&quot;));</div><div class="line">		_adapter.activate();</div><div class="line">	&#125;</div><div class="line">	public void stop() &#123;</div><div class="line">		// TODO Auto-generated method stub</div><div class="line">		 _adapter.deactivate();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>2 配置文件 config.properties<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">IceBox.InheritProperties=1</div><div class="line">Ice.Trace.Network=1</div><div class="line">Ice.Trace.ThreadPool=1 </div><div class="line">#所有服务初始化完成之后打印 xxx ready</div><div class="line">IceBox.PrintServicesReady=SimplePrinterBox  ready.....</div><div class="line">#SimplePrinter配置</div><div class="line">IceBox.Service.SimplePrinter=com.feng.ice.server.icebox.IceBoxPrinter 100 101 102</div><div class="line">SimplePrinter.Endpoints=tcp -p 10000</div><div class="line">#SendMSM配置</div><div class="line">#IceBox.Service.SendMessage=com.feng.ice.server.icebox.IceBoxSendMSM  200 201 202</div><div class="line">#SendMessage.Endpoints=tcp -p 10001</div></pre></td></tr></table></figure></p>
<p>可以一个配置文件里配置多个服务，如上面的最后三句。<br>3 启动：main class com.zeroc.IceBox.Server  添加参数：<br>–Ice.Config=/路径/config.properties<br>4 客户端访问无变化。<br>5 更多参数参照官网说明。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/ice/">ice</a>►<a class="article-category-link" href="/categories/ice/收集/">收集</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/ice/">ice</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/09/01/ice起步-一/" title="ice起步(一)" itemprop="url">ice起步(一)</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="feng" target="_blank" itemprop="author">feng</a>
		
  <p class="article-time">
    <time datetime="2017-09-01T05:46:44.000Z" itemprop="datePublished"> 发表于 2017-09-01</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>看了一下 ZeroC Ice权威指南，可能版本问题<br>和实践起来完全不一样,生成的类也是和书上提到不一样。<br>特记录下来，供以后参考<br>环境  mac  ice 3.70<br>官网：<a href="https://zeroc.com" target="_blank" rel="external">https://zeroc.com</a><br>软件准备，<br>1， mac安装软ice<br>   brew install ice –with-Java，<br>   其他系统安装参照官网。<br>2， eclipse工具安装，选择help-&gt;Eclipse Marketplace<br>    输入zeroc ice 安装。  </p>
<pre><code>偏好设置--&gt; ice builder 配置Ice Home
</code></pre><hr>
<p>开发步骤：<br>1 编写slice文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[[&quot;java:package:com.feng.ice&quot;]]  </div><div class="line">module Demo</div><div class="line">&#123;</div><div class="line">    interface Printer</div><div class="line">    &#123;</div><div class="line">        void printString(string s);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>项目上右键 ice builder –&gt; compile<br>最后生成的包名是 com.feng.ice.Demo;<br>没事改改，尝试他们的关系。<br>将会生成四个文件：<br>_Markert.java<br>_PrinterPrxI.java<br>Printer.java<br>PrinterPrx.java<br>按书上说会生成什么helper的，我反正是没见到，网上大多教程也是生成一大堆，<br>还是实践的人太少啊。<br>2 ，服务器端<br>  A,实现接口<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">package com.feng.ice.server.impl;</div><div class="line">import com.feng.ice.Demo.Printer;</div><div class="line">import com.zeroc.Ice.Current;</div><div class="line">public class PrinterI  implements Printer &#123;</div><div class="line"> @Override</div><div class="line"> public void printString(String s, Current current) &#123;</div><div class="line">   System.out.println(&quot; printer server :&quot; + s);</div><div class="line"> &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>B,写个main方法，注册服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">package com.feng.ice.server;</div><div class="line">import com.feng.ice.server.impl.PrinterI;</div><div class="line">public class Server &#123;</div><div class="line">public static void main(String[] args) &#123;</div><div class="line"> try(com.zeroc.Ice.Communicator communicator = com.zeroc.Ice.Util.initialize(args))</div><div class="line">     &#123;</div><div class="line">         com.zeroc.Ice.ObjectAdapter adapter = communicator.createObjectAdapterWithEndpoints(&quot;SimplePrinterAdapter&quot;, &quot;default -p 10000&quot;);</div><div class="line">         com.zeroc.Ice.Object object = new PrinterI();</div><div class="line">         adapter.add(object, com.zeroc.Ice.Util.stringToIdentity(&quot;SimplePrinter&quot;));</div><div class="line">         adapter.activate();</div><div class="line">         communicator.waitForShutdown();</div><div class="line">     &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>启动起来，就OK了，注意会在10000端口号监听，所以要确保没有占用这个端口号。<br>3 客户端调用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">package com.feng.ice.client;</div><div class="line">import com.feng.ice.Demo.PrinterPrx;</div><div class="line">public class Client &#123;</div><div class="line">	public static void main(String[] args) &#123;</div><div class="line">		</div><div class="line">		try(com.zeroc.Ice.Communicator communicator = com.zeroc.Ice.Util.initialize(args)) </div><div class="line">        &#123;</div><div class="line">            com.zeroc.Ice.ObjectPrx base = communicator.stringToProxy(&quot;SimplePrinter:default -p 10000&quot;);</div><div class="line">            PrinterPrx printer =  PrinterPrx.checkedCast(base);</div><div class="line">            if(printer == null)</div><div class="line">            &#123;</div><div class="line">                throw new Error(&quot;Invalid proxy&quot;);</div><div class="line">            &#125;</div><div class="line">            for(int i=0;i&lt;10;i++)&#123;</div><div class="line">            	 printer.printString(&quot;Hello World! &quot; + i);</div><div class="line">            	 System.out.println(&quot;---------&gt;&quot; + i );</div><div class="line">            &#125;</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p> communicator.stringToProxy(“SimplePrinter:default -p 10000”);是关键，需要和服务器端保持一致。<br> 这样子一个简单的调用就应该可以了。接下来IceBox</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/ice/">ice</a>►<a class="article-category-link" href="/categories/ice/收集/">收集</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/ice/">ice</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/08/29/selenium-简单应用所踩过的坑/" title="selenium 简单应用所踩过的坑" itemprop="url">selenium 简单应用所踩过的坑</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="feng" target="_blank" itemprop="author">feng</a>
		
  <p class="article-time">
    <time datetime="2017-08-29T08:20:14.000Z" itemprop="datePublished"> 发表于 2017-08-29</time>
    
  </p>
</header>
    <div class="article-content">
        
        <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div></pre></td><td class="code"><pre><div class="line">Selenium 是个很神奇的工具，可以直接把各种浏览器启动起来，然后在里面执行各种操作。</div><div class="line">主要还是结合编程用于自动测试。可以直持 .net ,java,python等语言。但我这次使不是用于</div><div class="line">测试。这次是为了代理机器上vpn自动拨号，代理机器上的vpn是通过网页输入用户名密码进行登录，</div><div class="line">正好符合Selenium场景。</div><div class="line">环境:vs2015  </div><div class="line">下载： CodedUITestCrossBrowserSetup.msi  </div><div class="line">IEDriverServer_Win32_3.5.0.zip/IEDriverServer_x64_3.5.0.zip             selenium-dotnet-3.5.1.zip</div><div class="line">   </div><div class="line">1，安装   CodedUITestCrossBrowserSetup.msi,解压IEDriverServer_Win32_3.5.0.zip把.exe放入系统路径或是当前执行环境中</div><div class="line">  解压 selenium-dotnet-3.5.1.zip得到.net引用包。</div><div class="line">2 建立项目，在引用中加上 selenium-dotnet-3.5.1 的 dll</div><div class="line"></div><div class="line">开发中的问题：</div><div class="line">1.    &#123;&quot;Unexpected error launching Internet Explorer.</div><div class="line"> Browser zoom level was set to 84%. It should be set to 100%&quot;&#125;</div><div class="line"> 解决：</div><div class="line"> InternetExplorerOptions options = new InternetExplorerOptions();</div><div class="line"> options.IgnoreZoomLevel = true;</div><div class="line"> var  driver  =   new InternetExplorerDriver(options);</div><div class="line">2 解决非信任证书的提示问题：</div><div class="line">    driver.Navigate().GoToUrl(&quot;javascript:document.getElementById(&apos;overridelink&apos;).click()&quot;);</div><div class="line">3，window mode窗口的关闭</div><div class="line">   这个没有找到好的办法，通过执行js解决</div><div class="line">  首先切换到mode窗口，执行js  window.opener = null; window.close() </div><div class="line">4，提交按钮不响应，</div><div class="line">   简单粗暴，使用js 搞定 document.getElementById(&apos;submit_1&apos;).click()  </div><div class="line">5 confirm的确认</div><div class="line"> 这个没啥难点，关键是需要一点延时，不然报找不到</div><div class="line"> </div><div class="line"> 下面是全部代码</div><div class="line"></div><div class="line"> </div><div class="line">using OpenQA.Selenium.IE;</div><div class="line">using OpenQA.Selenium.Support.UI;</div><div class="line">using System;</div><div class="line">using System.Collections.Generic;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">namespace LanchIE</div><div class="line">&#123;</div><div class="line">    class Program</div><div class="line">    &#123;</div><div class="line">        static void Main(string[] args)</div><div class="line">        &#123;</div><div class="line">            InternetExplorerOptions options = new InternetExplorerOptions();</div><div class="line">            options.IgnoreZoomLevel = true;</div><div class="line">            var  driver  =   new InternetExplorerDriver(options);</div><div class="line">            driver.Url = &quot;https://xx.xxx.xxx.xx/&quot;;    </div><div class="line">            Console.WriteLine(&quot;start ie ok.....&quot;);</div><div class="line">            driver.Navigate().GoToUrl(&quot;javascript:document.getElementById(&apos;overridelink&apos;).click()&quot;);</div><div class="line">            //</div><div class="line">            String currWindow =  driver.CurrentWindowHandle;</div><div class="line">             ICollection&lt;String&gt; windows =  driver.WindowHandles;</div><div class="line">                 foreach(String s in  windows )&#123;</div><div class="line">                    if (s.Equals(currWindow))</div><div class="line">                    &#123;</div><div class="line">                    &#125;</div><div class="line">                    else &#123;</div><div class="line">                        var popup = driver.SwitchTo().Window(s);</div><div class="line">                        driver.ExecuteScript(&quot; window.opener = null; window.close()&quot;);</div><div class="line">                       // Console.WriteLine(s + popup.Url);</div><div class="line">                       // popup.Close();</div><div class="line">                    &#125;   </div><div class="line">                 &#125;</div><div class="line">            driver.SwitchTo().Window(currWindow);</div><div class="line">            driver.FindElementById(&quot;name_1&quot;).SendKeys(&quot;guangfengtongtian1_cb&quot;);</div><div class="line">            driver.FindElementById(&quot;pwd_1&quot;).SendKeys(&quot;picc@bj&quot;);</div><div class="line">           Console.WriteLine( driver.FindElementById(&quot;submit_1&quot;).GetAttribute(&quot;value&quot;));</div><div class="line">           // driver.FindElementById(&quot;submit_1&quot;).Click();</div><div class="line">            var js = &quot;document.getElementById(&apos;submit_1&apos;).click()&quot;;</div><div class="line">            driver.ExecuteScript(js);</div><div class="line">            //wait 100 uMs *  1000000</div><div class="line">            WebDriverWait wait = new WebDriverWait(driver,new  TimeSpan(100000000));</div><div class="line">            wait.Until(ExpectedConditions.AlertIsPresent());</div><div class="line">             </div><div class="line">            var alt = driver.SwitchTo().Alert();</div><div class="line">            if (alt != null) &#123;</div><div class="line">                alt.Accept();</div><div class="line">            &#125;</div><div class="line">            driver.SwitchTo().Window(currWindow);</div><div class="line"></div><div class="line"></div><div class="line">            // driver.FindElementByClassName(&quot;btn_login&quot;).Click();</div><div class="line">            //driver.FindElementById</div><div class="line">            //  driver.Quit();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        </div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/收集/">收集</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/selenium/">selenium</a><a href="/tags/测试/">测试</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/08/09/docker-管理工具nsenter/" title="docker 管理工具nsenter" itemprop="url">docker 管理工具nsenter</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="feng" target="_blank" itemprop="author">feng</a>
		
  <p class="article-time">
    <time datetime="2017-08-09T02:09:05.000Z" itemprop="datePublished"> 发表于 2017-08-09</time>
    
  </p>
</header>
    <div class="article-content">
        
        <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">docker 是不提倡在image里安装sshd用于管理，当然非要这1么干也不是不行。现在说说 nsenter 工具使用</div><div class="line">1 安装，安装很容易，以下会把命令会把运行镜像，把nsenter复制到 /usr/local/bin</div><div class="line">docker run -v /usr/local/bin:/target jpetazzo/nsenter    </div><div class="line">运行完了image都可以不要了，过河折桥  </div><div class="line">2 进入docker</div><div class="line">先获取docker PID</div><div class="line">docker inspect --format &#123;&#123;.State.Pid&#125;&#125; &lt;container_name_or_ID&gt;</div><div class="line">例如：</div><div class="line">ocker inspect --format &#123;&#123;.State.Pid&#125;&#125; 2c72a3017a25  </div><div class="line">29226</div><div class="line">然后，</div><div class="line">nsenter --target 29226 --mount --uts --ipc --net --pid</div><div class="line">29226就是一上步获取到的PID</div><div class="line">为了操作简单，可以写个脚本， 列出当前运行的容器，然后选择一个，直接登录 ，核心就两句</div><div class="line"></div><div class="line">PID=`docker inspect --format &#123;&#123;.State.Pid&#125;&#125;  2c72a3017a25&lt;这个是容器ID&gt;`</div><div class="line">nsenter --target $PID --mount --uts --ipc --net --pid  </div><div class="line">等我写好了贴上做记录。</div></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/收集/">收集</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/docker/">docker</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/08/08/jenkins-Wrong-volume-permissions/" title="jenkins  Wrong volume permissions" itemprop="url">jenkins  Wrong volume permissions</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="feng" target="_blank" itemprop="author">feng</a>
		
  <p class="article-time">
    <time datetime="2017-08-08T09:37:24.000Z" itemprop="datePublished"> 发表于 2017-08-08</time>
    
  </p>
</header>
    <div class="article-content">
        
        <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Linux 主机， root账号运行 docker运行 jenkins 一切正常，</div><div class="line">当挂载主机目录时，则出现   </div><div class="line"></div><div class="line">touch: cannot touch ‘/var/jenkins_home/copy_reference_file.log’: Permission denied</div><div class="line">Can not write to /var/jenkins_home/copy_reference_file.log. Wrong volume permissions?</div><div class="line"></div><div class="line">解决步骤：   </div><div class="line">1，确认目录权限  </div><div class="line"> docker run -ti --rm --entrypoint=&quot;/bin/bash&quot; jenkins -c &quot;whoami &amp;&amp; id&quot;</div><div class="line"> jenkins</div><div class="line"> uid=1000(jenkins) gid=1000(jenkins) groups=1000(jenkins) </div><div class="line"> 而本地的 /var/jenkins_home 是root用户创建， </div><div class="line"> </div><div class="line"> uid=0(root) gid=0(root) 组=0(root) 环境=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023</div><div class="line">2，/var/jenkins_home </div><div class="line">chown -R 1000 /var/jenkins_home  </div><div class="line">注意，可能本地没有1000的用户，如果没有需要创建，但用户名不必为jenkins</div><div class="line">如果有则可不必计较，虽然用户名可能不一是jenkins</div><div class="line">3,再启动试试，可能还是有问题</div><div class="line">这时查看 SELinux状态  /usr/sbin/sestatus -v    </div><div class="line">如果没有关闭，需要关闭</div><div class="line">关闭SELinux：</div><div class="line">1、临时关闭（不用重启机器）：</div><div class="line">setenforce 0                  ##设置SELinux 成为permissive模式</div><div class="line">                              ##setenforce 1 设置SELinux 成为enforcing模式</div><div class="line">2、修改配置文件需要重启机器：</div><div class="line">修改/etc/selinux/config 文件</div><div class="line">将SELINUX=enforcing改为SELINUX=disabled</div><div class="line">重启机器即可</div></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/收集/">收集</a>►<a class="article-category-link" href="/categories/收集/各种坑/">各种坑</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/docker/">docker</a><a href="/tags/jenkins/">jenkins</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/06/22/centos7-ss5安装配置/" title="centos7 ss5安装配置" itemprop="url">centos7 ss5安装配置</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="feng" target="_blank" itemprop="author">feng</a>
		
  <p class="article-time">
    <time datetime="2017-06-22T06:17:00.000Z" itemprop="datePublished"> 发表于 2017-06-22</time>
    
  </p>
</header>
    <div class="article-content">
        
        <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">yum -y install gcc automake make</div><div class="line">yum -y install pam-devel openldap-devel cyrus-sasl-devel openssl-devel</div><div class="line"></div><div class="line"></div><div class="line">wget http://jaist.dl.sourceforge.net/sourceforge/ss5/ss5-3.6.1-1.tar.gz</div><div class="line">tar zxvf ss5-3.6.1-1.tar.gz</div><div class="line">cd ss5-3.6.1</div><div class="line">./configure</div><div class="line">make</div><div class="line">make install</div><div class="line"></div><div class="line">#启动ss5服务</div><div class="line">/etc/init.d/ss5 start</div><div class="line"></div><div class="line">注意，ss5可能没有x权限，需要手动加上</div><div class="line">配黑点文件：   </div><div class="line"> /etc/opt/ss5/ss5.conf</div><div class="line"> 默认端口1080 </div><div class="line"> 默认是无权限验证  </div><div class="line"> </div><div class="line"> #       SHost           SPort           Authentication</div><div class="line">#</div><div class="line">auth    0.0.0.0/0               -              -</div><div class="line">但这样可能还是代理上不了的</div><div class="line">需要更改   为可用（去掉注释）</div><div class="line">permit -        0.0.0.0/0       -       0.0.0.0/0       -       -       -       -       -</div><div class="line"> 如果不记录日志：</div><div class="line"> /etc/init.d/ss5 添加 -m</div><div class="line"> # Start daemon.</div><div class="line">echo -n &quot;Starting ss5... &quot;</div><div class="line">if [ $OS = &quot;Linux&quot; ]; then</div><div class="line">daemon /usr/sbin/ss5 -m -t $SS5_OPTS</div><div class="line">touch /var/lock/subsys/ss5</div><div class="line">if [ $OS = &quot;SunOS&quot; ]; then</div><div class="line">/usr/sbin/ss5 -m -t</div><div class="line">touch /var/lock/subsys/ss5</div><div class="line">else</div><div class="line">/usr/local/sbin/ss5 -m -t</div><div class="line">fi</div><div class="line">echo &quot;done&quot;</div><div class="line">fi</div><div class="line"></div><div class="line">其它：建立定时自动重启ss5的脚本ss5restart.sh （解决ss5断断续续出现1080端口不通的问题）</div><div class="line"></div><div class="line">*/10 * * * *  /etc/init.d/ss5 restart</div></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/收集/">收集</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/linux/">linux</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/06/05/Mac-linux环境tess4j使用/" title="Mac,linux环境tess4j使用" itemprop="url">Mac,linux环境tess4j使用</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="feng" target="_blank" itemprop="author">feng</a>
		
  <p class="article-time">
    <time datetime="2017-06-05T00:55:24.000Z" itemprop="datePublished"> 发表于 2017-06-05</time>
    
  </p>
</header>
    <div class="article-content">
        
        <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">tess4j是一个java环境的图形识别软件，它是通过JNA调用dll或so达到识别图片的功能。</div><div class="line">在window环境，JAR包中已包含dll,不用处理即可。简单几行代码即可</div><div class="line">File imageFile = new File(&quot;/Users/feng/Documents/workspace/rand-code-imgage.jpg&quot;);  </div><div class="line">        ITesseract instance = new Tesseract();  // JNA Interface Mapping  </div><div class="line">        instance.setDatapath(&quot;/Users/feng/Downloads/Tess4J3.3.1/tessdata&quot;);</div><div class="line">         </div><div class="line">          String result = instance.doOCR(imageFile);  </div><div class="line">          System.out.println(result);  </div><div class="line">setDatapath 需要下载最新的tessdata。可去官网下载。</div><div class="line"></div><div class="line">在Mac环境，需要自己安装 tesseract </div><div class="line">brew install tesseract --all-languages   </div><div class="line">在linux (centos)安装：</div><div class="line">在安装了epel后，</div><div class="line">yum install tesseract 即可</div></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/收集/">收集</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/tess4j/">tess4j</a><a href="/tags/开发/">开发</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/">Next<span></span></a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  


  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/blog/" title="blog">blog<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/ectd/" title="ectd">ectd<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/node/excel/" title="excel">excel<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/ice/" title="ice">ice<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/ectd/linux/" title="linux">linux<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/vpn/linux/" title="linux">linux<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/node/" title="node">node<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/vpn/" title="vpn">vpn<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/收集/各种坑/" title="各种坑">各种坑<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/各种坑/" title="各种坑">各种坑<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/开发/" title="开发">开发<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/总结/" title="总结">总结<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/ice/收集/" title="收集">收集<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/ectd/linux/收集/" title="收集">收集<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/收集/" title="收集">收集<sup>17</sup></a></li>
		  
		
		  
			<li><a href="/categories/vpn/linux/收集/" title="收集">收集<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/blog/软件/" title="软件">软件<sup>2</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/linux/" title="linux">linux<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/node/" title="node">node<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/thrift/" title="thrift">thrift<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/开发/" title="开发">开发<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/nginx/" title="nginx">nginx<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/go/" title="go">go<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/ice/" title="ice">ice<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/docker/" title="docker">docker<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/hexo/" title="hexo">hexo<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/vpn/" title="vpn">vpn<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/selenium/" title="selenium">selenium<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/https/" title="https">https<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/jenkins/" title="jenkins">jenkins<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/hibernate/" title="hibernate">hibernate<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/mongo/" title="mongo">mongo<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/jquery/" title="jquery">jquery<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/测试/" title="测试">测试<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/收集/" title="收集">收集<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/spring/" title="spring">spring<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/tess4j/" title="tess4j">tess4j<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=null&verifier=&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> 世界上只有一种英雄主义,就是看清生活的真相之后依然热爱生活。 <br/>
			</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2017 
		
		<a href="/about" target="_blank" title="feng">feng</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>










<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->





<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>

